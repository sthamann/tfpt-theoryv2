(* ::Package:: *)

(* ::Text:: *)
(*This file was automatically generated by PyR@TE 3.*)
(*Model : SM_TFPT_2Loop_v25*)
(*Author : TFPT (v2.5) â€“ Standard Model 2-loop baseline for RG fingerprints*)
(**)
(*Section 1 contains the renormalization group equations.*)
(*Section 2 is a proposition of a minimal working code to solve the RGEs and plot the running couplings.*)
(*Section 3 should be completed by the user since it contains the initial conditions for the running couplings.*)
(* ::Subsection:: *)
(*1. RGEs*)

(* \[Beta]-function definition *)

\[Beta][x_] := 1*Sum[If[With[{j=i}, ValueQ[\[Beta][x, j]]] && (!ValueQ[loops[x]] || i <= loops[x]),  1/(4 Pi)^(2*i)*\[Beta][x,i], 0], {i,1}]*Log[10];


(* Gauge Couplings *)

GaugeCouplings = {g1, g2, g3};

\[Beta][g1, 1] = (41/6)*g1^3;
\[Beta][g2, 1] = -19/6*g2^3;
\[Beta][g3, 1] = -7*g3^3;


(* Yukawa Couplings *)

YukawaCouplings = {Yu, Yd, Ye};

\[Beta][Yu, 1] = -17/12*g1^2*Yu - 9/4*g2^2*Yu - 8*g3^2*Yu + 3*Tr[ConjugateTranspose[Yd].Yd]*Yu + (Tr[ConjugateTranspose[Ye].Ye])*Yu + 3*Tr[ConjugateTranspose[Yu].Yu]*Yu - (3/2)*Yd.ConjugateTranspose[Yd].Yu + (3/2)*Yu.ConjugateTranspose[Yu].Yu;
\[Beta][Yd, 1] = -5/12*g1^2*Yd - 9/4*g2^2*Yd - 8*g3^2*Yd + 3*Tr[ConjugateTranspose[Yd].Yd]*Yd + (Tr[ConjugateTranspose[Ye].Ye])*Yd + 3*Tr[ConjugateTranspose[Yu].Yu]*Yd + (3/2)*Yd.ConjugateTranspose[Yd].Yd - (3/2)*Yu.ConjugateTranspose[Yu].Yd;
\[Beta][Ye, 1] = -15/4*g1^2*Ye - 9/4*g2^2*Ye + 3*Tr[ConjugateTranspose[Yd].Yd]*Ye + (Tr[ConjugateTranspose[Ye].Ye])*Ye + 3*Tr[ConjugateTranspose[Yu].Yu]*Ye + (3/2)*Ye.ConjugateTranspose[Ye].Ye;


(* Quartic Couplings *)

QuarticCouplings = {lambda};

\[Beta][lambda, 1] = (3/8)*g1^4 + (3/4)*g1^2*g2^2 - 3*g1^2*lambda + (9/8)*g2^4 - 9*g2^2*lambda + 24*lambda^2 + 12*lambda*Tr[ConjugateTranspose[Yd].Yd] + 4*lambda*Tr[ConjugateTranspose[Ye].Ye] + 12*lambda*Tr[ConjugateTranspose[Yu].Yu] - 6*Tr[ConjugateTranspose[Yd].Yd.ConjugateTranspose[Yd].Yd] - 2*Tr[ConjugateTranspose[Ye].Ye.ConjugateTranspose[Ye].Ye] - 6*Tr[ConjugateTranspose[Yu].Yu.ConjugateTranspose[Yu].Yu];


(* Scalar Mass Couplings *)

ScalarMassCouplings = {mu2};

\[Beta][mu2, 1] = -3/2*g1^2*mu2 - 9/2*g2^2*mu2 + 12*lambda*mu2 + 6*mu2*Tr[ConjugateTranspose[Yd].Yd] + 2*mu2*Tr[ConjugateTranspose[Ye].Ye] + 6*mu2*Tr[ConjugateTranspose[Yu].Yu];


(* Vacuum-expectation Values *)

Vevs = {vSM};

(* For vevs the gauge must be fixed. Let's use for instance the Landau gauge : *)
xiGauge = 0;

\[Beta][vSM, 1] = (1/4)*xiGauge*g1^2*vSM + (3/4)*xiGauge*g2^2*vSM + (3/4)*g1^2*vSM + (9/4)*g2^2*vSM - 3*vSM*Tr[ConjugateTranspose[Yd].Yd] - vSM*Tr[ConjugateTranspose[Ye].Ye] - 3*vSM*Tr[ConjugateTranspose[Yu].Yu];
(* ::Subsection:: *)
(*2. Solving and plotting functions*)

(* ::Subsubsection::Closed:: *)
(*RG-solving functions*)

(* Solving function *)

RGsolve[initialScale_, range_] := Block[{allCouplings, couplingsToFunction, differentialEquations, initialConditions, allEquations, solutions, yukawaLike},
	(* Define and solve the system of coupled differential equations *)
	allCouplings = Join[GaugeCouplings, YukawaCouplings, QuarticCouplings, ScalarMassCouplings, Vevs];
	couplingsToFunction = # -> #[t] & /@ allCouplings;

	differentialEquations = (#'[t] == (\[Beta][#] /. couplingsToFunction) & /@ allCouplings);
	initialConditions = (#[initialScale] == init[#] & /@ allCouplings);
	allEquations = Join[differentialEquations, initialConditions];

	solutions = NDSolve[allEquations, allCouplings /. couplingsToFunction, {t, range[[1]], range[[2]]}][[1]];

	(* Now split matrix couplings into their individual components *)
	yukawaLike = {{Yu, {3, 3}}, {Yd, {3, 3}}, {Ye, {3, 3}}};
	solutions = Block[{coupling, function, shape},
					coupling = #[[1,0]];
					function = #[[2]];
					If[MemberQ[Flatten@yukawaLike, coupling],
						shape = yukawaLike[[Position[yukawaLike, coupling][[1,1]], 2]];
						Sequence @@ Flatten @ Table[coupling[i,j] -> FunctionInterpolation[If[NumericQ[t], function[[i,j]]], {t, range[[1]], range[[2]]}][t], {i, shape[[1]]}, {j, shape[[2]]}],
						coupling -> function]]& /@ solutions;

	Return[solutions];
];

(* The following function removes from the list the couplings which seem to identically vanish over the energy range *)
DiscardZeroCouplings[range_, solutions_] := Block[{N, testPoints},
	N = 20;
	testPoints =  Range[range[[1]], range[[2]], (range[[2]] - range[[1]])/N];
	Return @ Select[solutions, (DeleteDuplicates[#[[2, 0]] /@ testPoints] != {0}) &];
];
(* ::Subsubsection::Closed:: *)
(*Plot function*)

(* Plotting function handling both real and complex quantities *)

Complexplot[funcs_, {min_, max_}, legends_, plotRange_] := Block[{cplxPos, newFuncs, newLegends},
	cplxPos = If[Head[Chop[funcs[[#]] /. t -> 1/2(max-min)]] === Complex,#, Nothing]& /@ Range[Length[funcs]];
	newFuncs = If[MemberQ[cplxPos, #], Sequence @@ {Re@funcs[[#]], Im@funcs[[#]]}, funcs[[#]]]& /@ Range[Length[funcs]];
	newLegends = If[MemberQ[cplxPos, #], Sequence @@ {Re@legends[[#]], Im@legends[[#]]}, legends[[#]]]& /@ Range[Length[funcs]];

	Return @ Plot[Evaluate @ newFuncs, {t, min, max}, PlotLegends->newLegends, PlotRange->plotRange]
 ]


RGplot[range_, solutions_] := Block[{selectType, toPlot},
	selectType[type_] := Select[solutions, MemberQ[type, If[Head@#[[1]] =!= Symbol, Head@#[[1]], #[[1]]]]&];

	toPlot = selectType[GaugeCouplings];
	If[toPlot =!= {},
		Print["### Gauge Couplings ###"];
		Print @ Complexplot[toPlot[[All, 2]], range, toPlot[[All, 1]], All];
	];

	toPlot = selectType[YukawaCouplings];
	If[toPlot =!= {},
		Print["### Yukawa Couplings ###"];
		Print @ Complexplot[toPlot[[All, 2]], range, toPlot[[All, 1]], All];
	];

	toPlot = selectType[QuarticCouplings];
	If[toPlot =!= {},
		Print["### Quartic Couplings ###"];
		Print @ Complexplot[toPlot[[All, 2]], range, toPlot[[All, 1]], All];
	];

	toPlot = selectType[ScalarMassCouplings];
	If[toPlot =!= {},
		Print["### Scalar Mass Couplings ###"];
		Print @ Complexplot[toPlot[[All, 2]], range, toPlot[[All, 1]], All];
	];

	toPlot = selectType[Vevs];
	If[toPlot =!= {},
		Print["### Vacuum-expectation Values ###"];
		Print @ Complexplot[toPlot[[All, 2]], range, toPlot[[All, 1]], All];
	];
];
(* ::Subsection:: *)
(*3. Actual solving*)


(* Some useful quantities. Energy and mass are in units of Log10[ GeV ] *)

MZ = 91.1876                 // Log10; (* Z boson mass *)
MP = 1.22*10^19              // Log10; (* Planck mass *)
Mp = 1.22*10^19 / Sqrt[8 Pi] // Log10; (* Reduced Planck mass *)

MT = 173.0 // Log10; (* Pole top mass *)

vev = 246.22 // Log10; (* SM Higgs vacuum-expectation value *)


(*** Initial conditions ; Energy range ***)

initialScale = MZ;
range = {0, MP};

(* Gauge Couplings *)

init[g1] = 0;
init[g2] = 0;
init[g3] = 0;

(* Yukawa Couplings *)

init[Yu] = {{0, 0, 0},
            {0, 0, 0},
            {0, 0, 0}};

init[Yd] = {{0, 0, 0},
            {0, 0, 0},
            {0, 0, 0}};

init[Ye] = {{0, 0, 0},
            {0, 0, 0},
            {0, 0, 0}};

(* Quartic Couplings *)

init[lambda] = 0;

(* Scalar Mass Couplings *)

init[mu2] = 0;

(* Vacuum-expectation Values *)

init[vSM] = 0;


(* Definition of the running scheme *)

(loops[#] = 1)& /@ GaugeCouplings;
(loops[#] = 1)& /@ YukawaCouplings;
(loops[#] = 1)& /@ QuarticCouplings;
(loops[#] = 1)& /@ ScalarMassCouplings;
(loops[#] = 1)& /@ Vevs;


(* Now call the functions defined in section 2 *)

solutions = RGsolve[initialScale, range];
solutions = DiscardZeroCouplings[range, solutions];

RGplot[range, solutions]